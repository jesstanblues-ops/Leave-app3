{% extends 'base.html' %}
{% block content %}

<h3 class="mt-3">Admin Dashboard</h3>

<!-- Download Records -->
<p class="mt-3">
    <a href="{{ url_for('download_excel') }}" class="btn btn-success">
        ðŸ“¥ Download All Leave Records (Excel)
    </a>
</p>

<!-- Leave Requests Table -->
<h4 class="mt-4">Leave Requests</h4>

<table class="table table-sm table-bordered">
    <thead class="table-light">
        <tr>
            <th>Employee</th>
            <th>Type</th>
            <th>Dates</th>
            <th>Days</th>
            <th>Status</th>
            <th style="width:130px;">Action</th>
        </tr>
    </thead>
    <tbody>
    {% for l in leaves %}
        <tr>
            <td>{{ l.employee_name }}</td>
            <td>{{ l.leave_type }}</td>
            <td>{{ l.start_date }} â†’ {{ l.end_date }}</td>
            <td>{{ l.days }}</td>
            <td>{{ l.status }}</td>
            <td>
                {% if l.status == 'Pending' %}
                    <a href="/approve/{{ l.id }}" class="btn btn-success btn-sm">Approve</a>
                    <a href="/reject/{{ l.id }}" class="btn btn-danger btn-sm mt-1">Reject</a>
                {% else %}
                    -
                {% endif %}
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<!-- Employees Table -->
<h4 class="mt-4">Employees</h4>

<table class="table table-sm table-bordered">
    <thead class="table-light">
        <tr>
            <th>Name</th>
            <th>Entitlement</th>
            <th>Balance</th>
            <th style="width:210px;">Update Entitlement</th>
            <th style="width:210px;">Update Balance</th>
        </tr>
    </thead>
    <tbody>
    {% for e in employees %}
        <tr>
            <td>{{ e.name }}</td>
            <td>{{ e.entitlement }}</td>
            <td>{{ e.current_balance }}</td>

            <!-- Update Entitlement -->
            <td>
                <form method="post" action="/update_entitlement" class="d-flex">
                    <input type="hidden" name="name" value="{{ e.name }}">
                    <input type="number" step="0.25" name="entitlement"
                           class="form-control form-control-sm me-2"
                           placeholder="{{ e.entitlement }}">
                    <button class="btn btn-primary btn-sm">Save</button>
                </form>
            </td>

            <!-- Update Balance -->
            <td>
                <form method="post" action="/update_balance" class="d-flex">
                    <input type="hidden" name="name" value="{{ e.name }}">
                    <input type="number" step="0.25" name="balance"
                           class="form-control form-control-sm me-2"
                           placeholder="{{ e.current_balance }}">
                    <button class="btn btn-warning btn-sm">Save</button>
                </form>
            </td>

        </tr>
    {% endfor %}
    </tbody>
</table>

{% endblock %}
